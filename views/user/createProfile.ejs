<!-- this is create profile form for user -->

<% include ../partials/header %>

 <div id="main">
<!--router.post('/:user/saveProfile', middlewares.checkUserLoginStatus, userController.saveProfile)-->
	<form method="POST" action="/<%=username%>/saveProfile?_method=PUT" class="container form-resize">
	 	<fieldset class="p-2 m-2">
	 		<legend class="text-center p-2"> <%=customer.nameOfCustomer %> </legend>
	 		<!-- ISP dropdown -->
	 		<div class="dropdown show d-inline">
			  <a class="btn btn-lg dropdown-toggle choose-dropdown mb-3" href="#" role="button" name="profile(chooseISP)" id="chooseISP" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
				<% if(customer.nameOfIsp){ %>
					<span id="selected-isp"><%= customer.nameOfIsp %></span>
				<% } else { %>
					<span id="selected-isp">Choose ISP</span>
				<% } %>	
			  </a>

			  <div class="dropdown-menu" aria-labelledby="chooseISP">
			  	<!--all existing ISPs are shown in dropdown-->
				<% ispAll.forEach(function(isp){ %>
			    	<a class="dropdown-item isp choose-dropdown" href="javascript:void(0)" ><%= isp.nameOfIsp %></a>
					<% })%>
			  </div>
			  <!--it sends value of isp to controller to retrieve relevant packages-->
			  <input type='hidden' name='isp' value="" id="hidden-isp-field">
			</div>
	 		
	 		<!-- Package dropdown -->
			<div class="dropdown show my-4 d-inline">
				<a class="btn btn-lg dropdown-toggle package choose-dropdown mb-3" href="#" role="button" name="choosePackage" id="choosePackage" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
			    	<% if(customer.package){ %>
						<span id="selected-package"><%= customer.package %></span>
					<% } else { %>
						<span id="selected-package">Choose Package</span>
					<% } %>	
			    </a>
				<div id="show-package" class="dropdown-menu choose-dropdown" aria-labelledby="choosePackage"></div>
			</div>
			<input type='hidden' name='package' value="" id="hidden-package-field" ><!--it sends value of package to db-->

			<span class="text-danger error"></span> <!--if ajax call fails error contained here -->
			
	      	<!-- Customer ID -->
	      	<div class="form-group mt-4">
			    <label for="customerId"> Customer ID (hint: enter the ID provided by your ISP)</span></label>
			    <input type="text" class="form-control" name="customerId" id="customerId" autocomplete="off" value="<%=customer.customerId%>" placeholder="">
			</div>
			<!-- Phone -->
			<div class="form-group mt-4">
			    <label for="phone"> Phone (hint: it should contain 11 valid numbers) </label>
			    <div class="input-icon position-relative">
			    	<!--<span class="country-code position-absolute">+88 </span>-->
			    	<!--upper one is omitted as it needs more css to create the look-->
			    	<input type="text" value="+88" class="form-control" id="country-code" readonly>
			    	<input type="text" class="form-control" name="phone" id="phone" value="<%=customer.phone%>" onkeypress="return isNumber(event)"
			    	minlength="11" maxlength="11"placeholder="">
      			</div>
      			<!-- registration-form-validation.ejs contains the validation strategy -->
			    <span id="phone-validation-message"class=" message p-3 text-white"></span>
      		</div>
      		<!-- Address -->
	      	<div class="form-group mt-4">
			    <label for="address">Address</label>
			    <textarea class="form-control" id="address" name="address"rows="3" data-address="<%=customer.address%>"></textarea>
			</div>
	      	
			<input type="submit" id="isp-package" value="Submit Profile" class="col-12 col-md-4 btn submit">  
		</fieldset>
	</form>

 </div>
 <!--general footer-->
<% include ../partials/footer %>
<!--retrieve packages upon isp selection by AJAX call-->
<% include ../partials/validation/isp-packages-selection%>
<script type="text/javascript">
	$(function(){
		
		// user's address is open to edit in address field
		$('#address').text($('#address').data('address'));
		// control border-color of #country-code when focus/focusout event triggered on #phone
		$('#phone').focus(function(){
			$('#country-code').css({'border': '2px solid #80bdff','border-right':'0'});
		})
		$('#phone').focusout(function(){
			$('#country-code').css({'border-color': '#e6e6e6','border-right':'0'});
		})
	})
</script>





